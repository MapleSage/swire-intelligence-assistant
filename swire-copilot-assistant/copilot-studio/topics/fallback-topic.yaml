# Fallback Topic for Swire Intelligence Assistant
# Handles unrecognized intents and provides helpful guidance

kind: AdaptiveDialog
beginDialog:
  kind: OnUnknownIntent
  actions:
    - kind: SetProperty
      property: conversation.fallbackCount
      value: "${if(conversation.fallbackCount, add(conversation.fallbackCount, 1), 1)}"

    - kind: IfCondition
      condition: "conversation.fallbackCount <= 2"
      actions:
        - kind: SendActivity
          activity: |
            I didn't quite understand that. Let me help you find what you're looking for! ü§î

            I can assist you with:

            üí∞ **Finance & Budget**
            ‚Ä¢ "Show me this month's revenue"
            ‚Ä¢ "What's our budget variance?"
            ‚Ä¢ "Compare quarterly expenses"

            üõ°Ô∏è **Health, Safety & Environment**
            ‚Ä¢ "Recent safety incidents"
            ‚Ä¢ "HSE compliance status"
            ‚Ä¢ "Show safety trends"

            üë• **Human Resources**
            ‚Ä¢ "Workforce metrics this quarter"
            ‚Ä¢ "Department attendance rates"
            ‚Ä¢ "Employee productivity data"

            üìÑ **Document Search**
            ‚Ä¢ "Find safety procedures"
            ‚Ä¢ "Search HR policies"
            ‚Ä¢ "Locate technical manuals"

            üìä **Cross-Domain Analysis**
            ‚Ä¢ "Compare performance across departments"
            ‚Ä¢ "Generate executive summary"
            ‚Ä¢ "Show operational insights"

            Could you try rephrasing your question using one of these examples?

        - kind: SuggestedActions
          actions:
            - title: "üí∞ Finance Data"
              type: imBack
              value: "Show me financial performance"

            - title: "üõ°Ô∏è Safety Status"
              type: imBack
              value: "What's our current safety status?"

            - title: "üë• HR Metrics"
              type: imBack
              value: "Show workforce analytics"

            - title: "üîç Search Documents"
              type: imBack
              value: "Search company documents"

            - title: "‚ùì Get Help"
              type: imBack
              value: "Show me what you can do"

      elseActions:
        - kind: SendActivity
          activity: |
            I'm having trouble understanding your requests. Let me connect you with additional support options:

            ü§ñ **What I Can Help With:**
            ‚Ä¢ Financial data and reporting
            ‚Ä¢ Safety incidents and HSE metrics
            ‚Ä¢ HR analytics and workforce data
            ‚Ä¢ Company document search
            ‚Ä¢ Cross-functional business insights

            üë®‚Äçüíº **Need Human Help?**
            I can connect you with the appropriate team:
            ‚Ä¢ IT Support for technical issues
            ‚Ä¢ HR team for employee-related questions
            ‚Ä¢ Finance team for detailed financial analysis
            ‚Ä¢ HSE team for safety and compliance matters

            üìû **Contact Options:**
            ‚Ä¢ Email: support@swire.com
            ‚Ä¢ Phone: +44 (0) 20 1234 5678
            ‚Ä¢ Teams: @SwireSupport

            Would you like me to help you contact one of these teams?

        - kind: SuggestedActions
          actions:
            - title: "üîÑ Start Over"
              type: imBack
              value: "Hello"

            - title: "üìû Contact IT Support"
              type: imBack
              value: "Connect me with IT support"

            - title: "üë• Contact HR"
              type: imBack
              value: "Connect me with HR team"

            - title: "üí∞ Contact Finance"
              type: imBack
              value: "Connect me with Finance team"

triggers:
  - kind: OnIntent
    intent: Escalate
    actions:
      - kind: SendActivity
        activity: |
          I'll help you connect with the right support team. Which area do you need assistance with?

          üîß **Technical Support**
          For system issues, access problems, or technical difficulties

          üë• **HR Support**
          For employee-related questions, policies, or HR processes

          üí∞ **Finance Support**
          For detailed financial analysis, budget questions, or accounting matters

          üõ°Ô∏è **HSE Support**
          For safety incidents, compliance questions, or environmental matters

          üìã **General Support**
          For other questions or if you're not sure which team to contact

      - kind: SuggestedActions
        actions:
          - title: "üîß Technical Support"
            type: openUrl
            value: "mailto:it-support@swire.com?subject=Technical Support Request"

          - title: "üë• HR Support"
            type: openUrl
            value: "mailto:hr-support@swire.com?subject=HR Support Request"

          - title: "üí∞ Finance Support"
            type: openUrl
            value: "mailto:finance-support@swire.com?subject=Finance Support Request"

          - title: "üõ°Ô∏è HSE Support"
            type: openUrl
            value: "mailto:hse-support@swire.com?subject=HSE Support Request"

  - kind: OnIntent
    intent: Feedback
    actions:
      - kind: TextInput
        property: user.feedback
        prompt: |
          I'd love to hear your feedback! Please share your thoughts about:
          ‚Ä¢ How well I understood your requests
          ‚Ä¢ The quality and relevance of my responses
          ‚Ä¢ Suggestions for improvement
          ‚Ä¢ Any features you'd like to see added

        validations:
          - kind: Expression
            expression: "length(this.value) > 5"
            errorMessage: "Please provide some feedback (at least a few words)."

      - kind: HttpRequest
        method: POST
        url: "${settings.PowerPlatform.FeedbackUrl}"
        headers:
          Authorization: "Bearer ${settings.PowerPlatform.AccessToken}"
          Content-Type: "application/json"
        body:
          userId: "${user.id}"
          feedback: "${user.feedback}"
          conversationId: "${conversation.id}"
          timestamp: "${utcNow()}"
          rating: "${entities.Rating}"
        resultProperty: "conversation.feedbackResult"

      - kind: SendActivity
        activity: |
          Thank you for your feedback! üôè

          Your input helps us improve the Swire Intelligence Assistant. Our team will review your suggestions and work on making the experience even better.

          **Feedback Reference:** ${conversation.feedbackResult.referenceId}

          Is there anything else I can help you with today?

entities:
  - name: SupportType
    type: list
    values:
      - Technical
      - HR
      - Finance
      - HSE
      - General

  - name: Rating
    type: list
    values:
      - "1"
      - "2"
      - "3"
      - "4"
      - "5"

  - name: IssueCategory
    type: list
    values:
      - "Understanding Questions"
      - "Data Access"
      - "Response Quality"
      - "System Performance"
      - "Feature Request"
      - "Bug Report"
