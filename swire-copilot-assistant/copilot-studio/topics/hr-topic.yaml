# HR Topic for Swire Intelligence Assistant
# Handles workforce metrics, attendance, and HR analytics

kind: AdaptiveDialog
beginDialog:
  kind: OnIntent
  intent: HRQuery
  actions:
    - kind: SetProperty
      property: conversation.topic
      value: "HR"

    - kind: TextInput
      property: user.hrQuery
      prompt: |
        I can help you with Human Resources information. What would you like to know?

        Examples:
        â€¢ Workforce metrics and headcount analysis
        â€¢ Attendance rates and productivity data
        â€¢ Employee utilization by department
        â€¢ Training completion and compliance
        â€¢ Performance metrics and KPIs

      validations:
        - kind: Expression
          expression: "length(this.value) > 3"
          errorMessage: "Please provide more details about the HR information you need."

    - kind: HttpRequest
      method: POST
      url: "${settings.PowerPlatform.HRConnectorUrl}"
      headers:
        Authorization: "Bearer ${settings.PowerPlatform.AccessToken}"
        Content-Type: "application/json"
      body:
        query: "${user.hrQuery}"
        timeframe: "${entities.TimeFrame}"
        department: "${entities.Department}"
        metric: "${entities.HRMetric}"
        userId: "${user.id}"
      resultProperty: "conversation.hrData"

    - kind: IfCondition
      condition: "conversation.hrData.success == true"
      actions:
        - kind: SendActivity
          activity: |
            ## ğŸ‘¥ HR Analytics Summary

            **Period:** ${conversation.hrData.period}
            **Department:** ${conversation.hrData.department || 'All Departments'}

            ### Workforce Overview
            ğŸ‘¤ **Total Employees:** ${conversation.hrData.totalEmployees}
            ğŸ“ˆ **Headcount Change:** ${conversation.hrData.headcountChange} (${conversation.hrData.headcountChangePercent}%)
            â° **Total Man-Hours:** ${formatNumber(conversation.hrData.totalManHours)}
            ğŸ“Š **Utilization Rate:** ${conversation.hrData.utilizationRate}%

            ### Performance Metrics
            âœ… **Attendance Rate:** ${conversation.hrData.attendanceRate}%
            ğŸ¯ **Productivity Score:** ${conversation.hrData.productivityScore}/100
            ğŸ“š **Training Completion:** ${conversation.hrData.trainingCompletion}%
            ğŸ˜Š **Employee Satisfaction:** ${conversation.hrData.satisfactionScore}/10

            ### Department Breakdown
            ${foreach(conversation.hrData.departmentBreakdown, dept,
              `**${dept.name}:** ${dept.headcount} employees (${dept.utilization}% utilization)`
            )}

            ${if(conversation.hrData.insights, 
              `### ğŸ’¡ Key Insights\n${conversation.hrData.insights}`, 
              ''
            )}

        - kind: SuggestedActions
          actions:
            - title: "ğŸ“Š Department Analysis"
              type: imBack
              value: "Show detailed breakdown by department"

            - title: "ğŸ“ˆ Trend Analysis"
              type: imBack
              value: "Show HR trends over the last 6 months"

            - title: "ğŸ¯ Performance Metrics"
              type: imBack
              value: "Show detailed performance analytics"

            - title: "ğŸ“‹ Generate Report"
              type: imBack
              value: "Create HR summary report"

      elseActions:
        - kind: SendActivity
          activity: |
            I'm unable to access HR data at the moment. This could be due to:

            â€¢ Privacy restrictions or insufficient permissions
            â€¢ System maintenance or temporary unavailability
            â€¢ Network connectivity issues

            Please ensure you have the appropriate access rights or contact HR support.

            **Error Details:** ${conversation.hrData.error}

triggers:
  - kind: OnIntent
    intent: HRWorkforce
    actions:
      - kind: HttpRequest
        method: GET
        url: "${settings.PowerPlatform.HRConnectorUrl}/workforce"
        headers:
          Authorization: "Bearer ${settings.PowerPlatform.AccessToken}"
        resultProperty: "conversation.workforceData"

      - kind: SendActivity
        activity: |
          ## ğŸ‘¥ Workforce Analytics

          **Current Headcount:** ${conversation.workforceData.currentHeadcount}
          **Active Employees:** ${conversation.workforceData.activeEmployees}
          **Contractors:** ${conversation.workforceData.contractors}
          **New Hires (This Month):** ${conversation.workforceData.newHires}
          **Departures (This Month):** ${conversation.workforceData.departures}
          **Turnover Rate:** ${conversation.workforceData.turnoverRate}%

          ### Workforce by Department
          ${foreach(conversation.workforceData.byDepartment, dept,
            `**${dept.name}:** ${dept.headcount} employees\nğŸ“Š Capacity: ${dept.capacity}% | ğŸ“ˆ Growth: ${dept.growth}%`
          )}

          ### Workforce by Location
          ${foreach(conversation.workforceData.byLocation, location,
            `ğŸ“ **${location.name}:** ${location.headcount} employees (${location.percentage}%)`
          )}

  - kind: OnIntent
    intent: HRAttendance
    actions:
      - kind: HttpRequest
        method: GET
        url: "${settings.PowerPlatform.HRConnectorUrl}/attendance"
        headers:
          Authorization: "Bearer ${settings.PowerPlatform.AccessToken}"
        resultProperty: "conversation.attendanceData"

      - kind: SendActivity
        activity: |
          ## â° Attendance & Time Analytics

          **Overall Attendance Rate:** ${conversation.attendanceData.overallRate}%
          **Average Hours per Employee:** ${conversation.attendanceData.avgHoursPerEmployee}
          **Total Man-Hours (This Period):** ${formatNumber(conversation.attendanceData.totalManHours)}
          **Overtime Hours:** ${formatNumber(conversation.attendanceData.overtimeHours)}
          **Absence Rate:** ${conversation.attendanceData.absenceRate}%

          ### Attendance by Department
          ${foreach(conversation.attendanceData.byDepartment, dept,
            `**${dept.name}:** ${dept.attendanceRate}% ${if(dept.attendanceRate >= 95, 'âœ…', if(dept.attendanceRate >= 90, 'âš ï¸', 'âŒ'))}\nMan-Hours: ${formatNumber(dept.manHours)} | Utilization: ${dept.utilization}%`
          )}

          ### Top Performing Teams
          ${foreach(conversation.attendanceData.topPerformers, team,
            `ğŸ† **${team.name}:** ${team.attendanceRate}% attendance, ${team.productivityScore} productivity`
          )}

  - kind: OnIntent
    intent: HRProductivity
    actions:
      - kind: HttpRequest
        method: GET
        url: "${settings.PowerPlatform.HRConnectorUrl}/productivity"
        headers:
          Authorization: "Bearer ${settings.PowerPlatform.AccessToken}"
        resultProperty: "conversation.productivityData"

      - kind: SendActivity
        activity: |
          ## ğŸ¯ Productivity & Performance

          **Overall Productivity Score:** ${conversation.productivityData.overallScore}/100
          **Performance Trend:** ${conversation.productivityData.trend} ${if(conversation.productivityData.improving, 'ğŸ“ˆ', 'ğŸ“‰')}
          **Goals Achievement Rate:** ${conversation.productivityData.goalsAchievement}%
          **Training Completion Rate:** ${conversation.productivityData.trainingCompletion}%

          ### Productivity by Function
          ${foreach(conversation.productivityData.byFunction, func,
            `**${func.name}:** ${func.score}/100 ${if(func.score >= 80, 'ğŸŸ¢', if(func.score >= 60, 'ğŸŸ¡', 'ğŸ”´'))}\nEfficiency: ${func.efficiency}% | Quality: ${func.quality}%`
          )}

          ### Key Performance Indicators
          ${foreach(conversation.productivityData.kpis, kpi,
            `ğŸ“Š **${kpi.name}:** ${kpi.current} ${if(kpi.trend == 'up', 'ğŸ“ˆ', if(kpi.trend == 'down', 'ğŸ“‰', 'â¡ï¸'))}\nTarget: ${kpi.target} | Variance: ${kpi.variance}%`
          )}

          ### Improvement Opportunities
          ${foreach(conversation.productivityData.improvements, improvement,
            `ğŸ’¡ **${improvement.area}:** ${improvement.recommendation}\nPotential Impact: ${improvement.impact}`
          )}

  - kind: OnIntent
    intent: HRTraining
    actions:
      - kind: HttpRequest
        method: GET
        url: "${settings.PowerPlatform.HRConnectorUrl}/training"
        headers:
          Authorization: "Bearer ${settings.PowerPlatform.AccessToken}"
        resultProperty: "conversation.trainingData"

      - kind: SendActivity
        activity: |
          ## ğŸ“š Training & Development

          **Overall Completion Rate:** ${conversation.trainingData.completionRate}%
          **Active Training Programs:** ${conversation.trainingData.activePrograms}
          **Employees in Training:** ${conversation.trainingData.employeesInTraining}
          **Compliance Training Status:** ${conversation.trainingData.complianceStatus}%

          ### Training by Category
          ${foreach(conversation.trainingData.byCategory, category,
            `**${category.name}:** ${category.completionRate}% complete\nEnrolled: ${category.enrolled} | Completed: ${category.completed}`
          )}

          ### Upcoming Training Requirements
          ${foreach(conversation.trainingData.upcoming, training,
            `ğŸ“… **${training.name}**\nDue: ${formatDate(training.dueDate)} | Assigned: ${training.assignedCount} employees`
          )}

entities:
  - name: HRMetric
    type: list
    values:
      - Headcount
      - Attendance
      - Productivity
      - Performance
      - Training
      - Utilization
      - Satisfaction
      - Turnover

  - name: EmployeeType
    type: list
    values:
      - "Full-time"
      - "Part-time"
      - "Contractor"
      - "Temporary"
      - "Intern"

  - name: PerformanceLevel
    type: list
    values:
      - Excellent
      - Good
      - Satisfactory
      - "Needs Improvement"
      - Unsatisfactory

  - name: TrainingType
    type: list
    values:
      - "Safety Training"
      - "Technical Skills"
      - "Leadership Development"
      - "Compliance Training"
      - "Soft Skills"
      - "Professional Development"
